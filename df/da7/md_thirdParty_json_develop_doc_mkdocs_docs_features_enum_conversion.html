<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DDC Tool: Specializing enum conversion</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DDC Tool
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Specializing enum conversion </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >By default, enum values are serialized to JSON as integers. In some cases this could result in undesired behavior. If an enum is modified or re-ordered after data has been serialized to JSON, the later de-serialized JSON data may be undefined or a different enum value than was originally intended.</p>
<p >It is possible to more precisely specify how a given enum is mapped to and from JSON as shown below:</p>
<div class="fragment"><div class="line"><span class="comment">// example enum type declaration</span></div>
<div class="line"><span class="keyword">enum</span> TaskState {</div>
<div class="line">    TS_STOPPED,</div>
<div class="line">    TS_RUNNING,</div>
<div class="line">    TS_COMPLETED,</div>
<div class="line">    TS_INVALID=-1,</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// map TaskState values to JSON as strings</span></div>
<div class="line"><a class="code hl_define" href="../../d5/dec/macro__scope_8hpp.html#a4c5d399dfa9252e70f876756f3f49084">NLOHMANN_JSON_SERIALIZE_ENUM</a>( TaskState, {</div>
<div class="line">    {TS_INVALID, <span class="keyword">nullptr</span>},</div>
<div class="line">    {TS_STOPPED, <span class="stringliteral">&quot;stopped&quot;</span>},</div>
<div class="line">    {TS_RUNNING, <span class="stringliteral">&quot;running&quot;</span>},</div>
<div class="line">    {TS_COMPLETED, <span class="stringliteral">&quot;completed&quot;</span>},</div>
<div class="line">})</div>
<div class="ttc" id="amacro__scope_8hpp_html_a4c5d399dfa9252e70f876756f3f49084"><div class="ttname"><a href="../../d5/dec/macro__scope_8hpp.html#a4c5d399dfa9252e70f876756f3f49084">NLOHMANN_JSON_SERIALIZE_ENUM</a></div><div class="ttdeci">#define NLOHMANN_JSON_SERIALIZE_ENUM(ENUM_TYPE,...)</div><div class="ttdoc">macro to briefly define a mapping between an enum and JSON</div><div class="ttdef"><b>Definition:</b> macro_scope.hpp:99</div></div>
</div><!-- fragment --><p >The <code><a class="el" href="../../d5/dec/macro__scope_8hpp.html#a4c5d399dfa9252e70f876756f3f49084" title="macro to briefly define a mapping between an enum and JSON">NLOHMANN_JSON_SERIALIZE_ENUM()</a></code> macro declares a set of <code>to_json()</code> / <code><a class="el" href="../../d0/d28/unit-regression2_8cpp.html#ae14d47158b902877a3fc6840ea80dd02">from_json()</a></code> functions for type <code>TaskState</code> while avoiding repetition and boilerplate serialization code.</p>
<h1>Usage</h1>
<div class="fragment"><div class="line"><span class="comment">// enum to JSON as string</span></div>
<div class="line"><a class="code hl_class" href="../../d9/dcc/classnlohmann_1_1basic__json.html">json</a> <a class="code hl_variable" href="../../dc/d09/parse____allow__exceptions_8cpp.html#ac657f5945687365edd0e109857d4fec0">j</a> = TS_STOPPED;</div>
<div class="line"><a class="code hl_function" href="../../d7/de9/FuzzerTracePC_8cpp.html#aa099297e8e2ed3ff1bcc3de3ff413238">assert</a>(<a class="code hl_variable" href="../../dc/d09/parse____allow__exceptions_8cpp.html#ac657f5945687365edd0e109857d4fec0">j</a> == <span class="stringliteral">&quot;stopped&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// json string to enum</span></div>
<div class="line"><a class="code hl_class" href="../../d9/dcc/classnlohmann_1_1basic__json.html">json</a> j3 = <span class="stringliteral">&quot;running&quot;</span>;</div>
<div class="line"><a class="code hl_function" href="../../d7/de9/FuzzerTracePC_8cpp.html#aa099297e8e2ed3ff1bcc3de3ff413238">assert</a>(j3.<a class="code hl_function" href="../../d9/dcc/classnlohmann_1_1basic__json.html#af1650e004db368459b3c0db041b32adc">get</a>&lt;TaskState&gt;() == TS_RUNNING);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// undefined json value to enum (where the first map entry above is the default)</span></div>
<div class="line"><a class="code hl_class" href="../../d9/dcc/classnlohmann_1_1basic__json.html">json</a> jPi = 3.14;</div>
<div class="line"><a class="code hl_function" href="../../d7/de9/FuzzerTracePC_8cpp.html#aa099297e8e2ed3ff1bcc3de3ff413238">assert</a>(jPi.<a class="code hl_function" href="../../d9/dcc/classnlohmann_1_1basic__json.html#af1650e004db368459b3c0db041b32adc">get</a>&lt;TaskState&gt;() == TS_INVALID );</div>
<div class="ttc" id="aFuzzerTracePC_8cpp_html_aa099297e8e2ed3ff1bcc3de3ff413238"><div class="ttname"><a href="../../d7/de9/FuzzerTracePC_8cpp.html#aa099297e8e2ed3ff1bcc3de3ff413238">assert</a></div><div class="ttdeci">assert(Idx&lt; N)</div></div>
<div class="ttc" id="aclassnlohmann_1_1basic__json_html"><div class="ttname"><a href="../../d9/dcc/classnlohmann_1_1basic__json.html">nlohmann::basic_json</a></div><div class="ttdoc">a class to store JSON values</div><div class="ttdef"><b>Definition:</b> json.hpp:177</div></div>
<div class="ttc" id="aclassnlohmann_1_1basic__json_html_af1650e004db368459b3c0db041b32adc"><div class="ttname"><a href="../../d9/dcc/classnlohmann_1_1basic__json.html#af1650e004db368459b3c0db041b32adc">nlohmann::basic_json::get</a></div><div class="ttdeci">auto get() const noexcept(noexcept(std::declval&lt; const basic_json_t &amp; &gt;().template get_impl&lt; ValueType &gt;(detail::priority_tag&lt; 4 &gt; {}))) -&gt; decltype(std::declval&lt; const basic_json_t &amp; &gt;().template get_impl&lt; ValueType &gt;(detail::priority_tag&lt; 4 &gt; {}))</div><div class="ttdoc">get a (pointer) value (explicit)</div><div class="ttdef"><b>Definition:</b> json.hpp:3177</div></div>
<div class="ttc" id="aparse____allow__exceptions_8cpp_html_ac657f5945687365edd0e109857d4fec0"><div class="ttname"><a href="../../dc/d09/parse____allow__exceptions_8cpp.html#ac657f5945687365edd0e109857d4fec0">j</a></div><div class="ttdeci">json j</div><div class="ttdef"><b>Definition:</b> parse__allow_exceptions.cpp:26</div></div>
</div><!-- fragment --><h1>Notes</h1>
<p >Just as in Arbitrary Type Conversions above,</p>
<ul>
<li><code><a class="el" href="../../d5/dec/macro__scope_8hpp.html#a4c5d399dfa9252e70f876756f3f49084" title="macro to briefly define a mapping between an enum and JSON">NLOHMANN_JSON_SERIALIZE_ENUM()</a></code> MUST be declared in your enum type's namespace (which can be the global namespace), or the library will not be able to locate it and it will default to integer serialization.</li>
<li>It MUST be available (e.g., proper headers must be included) everywhere you use the conversions.</li>
</ul>
<p >Other Important points:</p>
<ul>
<li>When using <code>get&lt;ENUM_TYPE&gt;()</code>, undefined JSON values will default to the first pair specified in your map. Select this default pair carefully.</li>
<li>If an enum or JSON value is specified more than once in your map, the first matching occurrence from the top of the map will be returned when converting to or from JSON. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DDC Tool: Unchecked access: operator[]</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DDC Tool
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Unchecked access: operator[] </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Overview</h1>
<p >Elements in a JSON object and a JSON array can be accessed via <code>#!cpp operator[]</code> similar to a <code>#!cpp std::map</code> and a <code>#!cpp std::vector</code>, respectively.</p>
<p >??? example </p><pre class="fragment">Consider the following JSON value:

```json
{
    "name": "Mary Smith",
    "age": 42,
    "hobbies": ["hiking", "reading"]
}
```

Assume the value is parsed to a `json` variable `j`.

| expression | value |
| ---------- | ----- |
| `#!cpp j`  | `#!json {"name": "Mary Smith", "age": 42, "hobbies": ["hiking", "reading"]}` |
| `#!cpp j["name"]`  | `#!json "Mary Smith"` |
| `#!cpp j["age"]`  | `#!json 42` |
| `#!cpp j["hobbies"]`  | `#!json ["hiking", "reading"]` |
| `#!cpp j["hobbies"][0]`  | `#!json "hiking"` |
| `#!cpp j["hobbies"][1]`  | `#!json "reading"` |
</pre><p> The return value is a reference, so it can be modify the original value. In case the passed object key is non-existing, a <code>#!json null</code> value is inserted which can be immediately be overwritten.</p>
<p >??? example </p><pre class="fragment">```cpp
j["name"] = "John Smith";
j["maidenName"] = "Jones";
```

This code produces the following JSON value:

```json
{
    "name": "John Smith",
    "maidenName": "Jones",
    "age": 42,
    "hobbies": ["hiking", "reading"]
}
```
</pre><p> When accessing an invalid index (i.e., an index greater than or equal to the array size), the JSON array is resized such that the passed index is the new maximal index. Intermediate values are filled with <code>#!json null</code>.</p>
<p >??? example </p><pre class="fragment">```cpp
j["hobbies"][0] = "running";
j["hobbies"][3] = "cooking";
```

This code produces the following JSON value:

```json
{
    "name": "John Smith",
    "maidenName": "Jones",
    "age": 42,
    "hobbies": ["running", "reading", null, "cooking"]
}
```
</pre> <h1>Notes</h1>
<p >!!! info "Design rationale" </p><pre class="fragment">The library behaves differently to `#!cpp std::vector` and `#!cpp std::map`:

- `#!cpp std::vector::operator[]` never inserts a new element.
- `#!cpp std::map::operator[]` is not available for const values.

The type `#!cpp json` wraps all JSON value types. It would be impossible to remove `operator[]` for const objects. At the same time, inserting elements for non-const objects is really convenient as it avoids awkward `insert` calls. To this end, we decided to have an inserting non-const behavior for both arrays and objects.
</pre><p> !!! info </p><pre class="fragment">The access is unchecked. In case the passed object key does not exist or the passed array index is invalid, no exception is thrown.
</pre><p> !!! danger </p><pre class="fragment">- It is **undefined behavior** to access a const object with a non-existing key.
- It is **undefined behavior** to access a const array with an invalid index.
- In debug mode, an **assertion** will fire in both cases. You can disable assertions by defining the preprocessor symbol `#!cpp NDEBUG` or redefine the macro [`JSON_ASSERT(x)`](../macros.md#json_assertx).
</pre><p> !!! failure "Exceptions" </p><pre class="fragment">`operator[]` can only be used with objects (with a string argument) or with arrays (with a numeric argument). For other types, a [`basic_json::type_error`](../../home/exceptions.md#jsonexceptiontype_error305) is thrown.
</pre> <h1>Summary</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">scenario   </th><th class="markdownTableHeadNone">non-const value   </th><th class="markdownTableHeadNone">const value    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">access to existing object key   </td><td class="markdownTableBodyNone">reference to existing value is returned   </td><td class="markdownTableBodyNone">const reference to existing value is returned    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">access to valid array index   </td><td class="markdownTableBodyNone">reference to existing value is returned   </td><td class="markdownTableBodyNone">const reference to existing value is returned    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">access to non-existing object key   </td><td class="markdownTableBodyNone">reference to newly inserted <code>#!json null</code> value is returned   </td><td class="markdownTableBodyNone"><b>undefined behavior</b>; assertion in debug mode    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">access to invalid array index   </td><td class="markdownTableBodyNone">reference to newly inserted <code>#!json null</code> value is returned; any index between previous maximal index and passed index are filled with <code>#!json null</code>   </td><td class="markdownTableBodyNone"><b>undefined behavior</b>; assertion in debug mode   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
